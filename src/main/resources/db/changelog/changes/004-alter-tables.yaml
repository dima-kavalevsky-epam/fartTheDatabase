databaseChangeLog:
  - changeSet:
      id: 004-1
      author: dev-team
      changes:
        - addColumn:
            tableName: users
            columns:
              - column:
                  name: created_at
                  type: TIMESTAMP
                  defaultValueComputed: "CURRENT_TIMESTAMP"

        - addColumn:
            tableName: users
            columns:
              - column:
                  name: updated_at
                  type: TIMESTAMP
                  defaultValueComputed: "CURRENT_TIMESTAMP"

        - addColumn:
            tableName: card_info
            columns:
              - column:
                  name: created_at
                  type: TIMESTAMP
                  defaultValueComputed: "CURRENT_TIMESTAMP"

        - addColumn:
            tableName: card_info
            columns:
              - column:
                  name: is_active
                  type: BOOLEAN
                  defaultValue: true

  - changeSet:
      id: 004-2
      author: dev-team
      changes:
        - createProcedure:
            procedureBody: |
              CREATE OR REPLACE FUNCTION update_updated_at_column()
              RETURNS TRIGGER AS $$
              BEGIN
                NEW.updated_at = CURRENT_TIMESTAMP;
                RETURN NEW;
              END;
              $$ language 'plpgsql';

        - createProcedure:
            procedureBody: |
              CREATE OR REPLACE TRIGGER update_users_updated_at
              BEFORE UPDATE ON users
              FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

        - createProcedure:
            procedureBody: |
              CREATE OR REPLACE TRIGGER update_card_info_updated_at
              BEFORE UPDATE ON card_info
              FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
